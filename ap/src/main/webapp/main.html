
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">


<title>Login</title>

<!-- Bootstrap core CSS -->
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="dashboard.css" rel="stylesheet">
 

</head>


<body>

	 
	
	 <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
     <div class="navbar-brand ">今日輸贏<div style="align: right; color: #FFFFFF" class="toDayWin">loading...</div></div>
	
	 <div class="navbar-brand "   >下次期數<div style="align: right; color: #FFFFFF" class="toPhase">2</div></div>
      
     </nav>
    
	  <div class="container-fluid">
      <div class="row">
       <!-- 
        ;navvar pwd = l-sm-3 col-md-2 ;
		var user= (ck bg-light sid;bar">
          <ul class="nav nav-pills flex-column">
            <li class="nav-item">
              <a class="nav-link" href="#">下注設定 <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">下注記錄</a>
            </li>
            
          </ul>
  
        </nav>
 			-->
        <main class="col-sm-9 ml-sm-auto col-md-10 pt-3" role="main">
        <br>
          <h1>下注設定</h1>

          <section class="row text-center placeholders">
            <div class="col-6 col-sm-3 placeholder">
               		<div>下注方式 <select class="type">
						  <option value="1">豆子-順打 </option>
						  <option value="2">豆子-反打</option>
						  <option value="3">順龍</option>
						  <option value="4">斬龍</option>
						</select>
					</div>
            </div>
            
            <div class="col-6 col-sm-3 placeholder">
               		<div>下注參數<input class="betlist" type ="text" size=15/>
					</div>
            </div>
            
             
            
            <div class="col-6 col-sm-3 placeholder">
               		<div>停損<input class="stoplose" type ="text" size=15/>
					</div>
            </div>
            
            <div class="col-6 col-sm-3 placeholder">
               		<div>停利<input class="stopwin" type ="text" size=15/>
					</div>
            </div>
              
          </section>

          <h2>下注記錄</h2> <!-- 
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Header</th>
                  <th>Header</th>
                  <th>Header</th>
                  <th>Header</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1,001</td>
                  <td>Lorem</td>
                  <td>ipsum</td>
                  <td>dolor</td>
                  <td>sit</td>
                </tr>
                <tr>
                  <td>1,002</td>
                  <td>amet</td>
                  <td>consectetur</td>
                  <td>adipiscing</td>
                  <td>elit</td>
                </tr>
                <tr>
                  <td>1,003</td>
                  <td>Integer</td>
                  <td>nec</td>
                  <td>odio</td>
                  <td>Praesent</td>
                </tr>
                <tr>
                  <td>1,003</td>
                  <td>libero</td>
                  <td>Sed</td>
                  <td>cursus</td>
                  <td>ante</td>
                </tr>
                <tr>
                  <td>1,004</td>
                  <td>dapibus</td>
                  <td>diam</td>
                  <td>Sed</td>
                  <td>nisi</td>
                </tr>
                <tr>
                  <td>1,005</td>
                  <td>Nulla</td>
                  <td>quis</td>
                  <td>sem</td>
                  <td>at</td>
                </tr>
                <tr>
                  <td>1,006</td>
                  <td>nibh</td>
                  <td>elementum</td>
                  <td>imperdiet</td>
                  <td>Duis</td>
                </tr>
                <tr>
                  <td>1,007</td>
                  <td>sagittis</td>
                  <td>ipsum</td>
                  <td>Praesent</td>
                  <td>mauris</td>
                </tr>
                <tr>
                  <td>1,008</td>
                  <td>Fusce</td>
                  <td>nec</td>
                  <td>tellus</td>
                  <td>sed</td>
                </tr>
                <tr>
                  <td>1,009</td>
                  <td>augue</td>
                  <td>semper</td>
                  <td>porta</td>
                  <td>Mauris</td>
                </tr>
                <tr>
                  <td>1,010</td>
                  <td>massa</td>
                  <td>Vestibulum</td>
                  <td>lacinia</td>
                  <td>arcu</td>
                </tr>
                <tr>
                  <td>1,011</td>
                  <td>eget</td>
                  <td>nulla</td>
                  <td>Class</td>
                  <td>aptent</td>
                </tr>
                <tr>
                  <td>1,012</td>
                  <td>taciti</td>
                  <td>sociosqu</td>
                  <td>ad</td>
                  <td>litora</td>
                </tr>
                <tr>
                  <td>1,013</td>
                  <td>torquent</td>
                  <td>per</td>
                  <td>conubia</td>
                  <td>nostra</td>
                </tr>
                <tr>
                  <td>1,014</td>
                  <td>per</td>
                  <td>inceptos</td>
                  <td>himenaeos</td>
                  <td>Curabitur</td>
                </tr>
                <tr>
                  <td>1,015</td>
                  <td>sodales</td>
                  <td>ligula</td>
                  <td>in</td>
                  <td>libero</td>
                </tr>
              </tbody>
            </table>
          </div>
          -->
          
          
        </main>
      </div>
    </div>
      
	<input type="hidden" id="uid" />
	<input type="hidden" id="user" />


</body>
</html>

<script src="jquery.js"> </script>
<script src="utils.js"> </script>
<script>
	 
 	const checkMinute = [4,9,14,19,24,29,34,39,44,49,54,,59];
 	var u = getUrl();
    var stoplose = "";
    var stopwin = "";
    var todayWin = "";
    var betarray = [];
    var betIndex = 0 ;
 	const rangeExist = {
 			'01' : ['09','10','01','02','03'] ,
 			'02' : ['10','01','02','03','04'] ,
 			'03' : ['01','02','03','04','05'] ,
 			'04' : ['02','03','04','05','06'] ,
 			'05' : ['03','04','05','06','07'] ,
 			'06' : ['04','05','06','07','08'] ,
 			'07' : ['05','06','07','08','09'] ,
 			'08' : ['06','07','08','09','10'] ,
 			'09' : ['07','08','09','10','01'] ,
 			'10' : ['08','09','10','01','02'] ,

 	};
    $(document).ready(function(){
		
		var query = window.location.search.substring(1);
		var parsed_qs = parse_query_string(query);
		var uid = (parsed_qs.uid) ;
		var pwd = (parsed_qs.pwd) ;
		var user= (parsed_qs.user);
		
		document.getElementById("uid").value = uid;
		document.getElementById("user").value = user;

		getWinFun();
		
	     
	  
		
		  
		 $( ".type" ).change(function() {
			 saveParam();
		 });
		 $( ".betlist" ).change(function() {
			 saveParam();
		 });
		 $( ".stoplose" ).change(function() {
			 saveParam();
		 });
		 $( ".stopwin" ).change(function() {
			 saveParam();
		 });
		  
		 
		 timeout();
		 
	});
	
    function pad2(n) { return n < 10 ? '0' + n : n }
    function getYYYYMMDDSS(){
   	 var date = new Date();
	
	 return ( date.getFullYear().toString() + '/' + pad2(date.getMonth() + 1)+ '/'  + pad2( date.getDate())+ '/' + pad2( date.getHours() )+ ':'  + pad2( date.getMinutes() )+ ':'  + pad2( date.getSeconds() ) );

    	
    }
    
    
    function getWinFun(){
    	 var url =  u + '/getTodayWin?user='+document.getElementById("user").value+'&uid='+encodeURI(document.getElementById("uid").value)  ;
		   
    	 $.ajax({ url:  url, 
	         async: false,
	         success: function(data) {
	        	 const json = JSON.parse(data);
		    	 	$( "div.toDayWin" ).text(json.todayWin);
		    	 	$( ".type" ).val(json.type);
		    	 	$( ".betlist" ).val(json.betlist) ;
		    	 	$( ".stoplose" ).val(json.stoplose) ;
		    	 	$( ".stopwin" ).val(json.stopwin);
		    	 	stoplose = json.stoplose;
		    	 	stopwin = json.stopwin;
		    	 	todayWin = json.todayWin;
		    	 	betarray = json.betlist.split(',');
	         	 }
	        });
    	 
	     
    	
    }
	function compareByType1(phase_before,phase_now,phase_before4){
		   
		const code_b = getCodeByPhase(phase_before); 
		const code_n = getCodeByPhase(phase_now);
		const code_before4 = getCodeByPhase(phase_before4);

		const array_b = code_b.split(',');
		const array_n = code_n.split(',');
		const array_before4 = code_before4.split(',');

		const bet_b = array_b[0];
		const bet_n = array_n[0];
		const bet_before4 = array_before4[0];

	 	var d = getYYYYMMDDSS();
	  
	    if(rangeExist[bet_b].indexOf(bet_n) != -1){ //預測到、關卡歸零
	    	 
	    	var log =  "此期" + phase_now  + "(開獎:"+code_n+")," +  " 前5期"+phase_before + "預測("+rangeExist[bet_b]+") ,有預測到，下一關，此注不下注" ;
 
	    	saveLog(document.getElementById("user").value,encodeURI(log));

	    	betIndex = 0;
		}else { //未預測到、投注
			//取前四期的號碼來預測投注
		 
	    	var log =  "此期" + phase_now  + "(開獎:"+code_n+")," + " 前5期"+phase_before + "預測("+rangeExist[bet_b]+") ,沒有預測到 ,下注" ;
	    	log+= "， 參考前四期"+  phase_before4 + "("+code_before4+"), 下注號碼"+ rangeExist[bet_before4];
			
	    	log+= ",下注金額:"+betarray[betIndex]
	    	 
	    	saveLog(document.getElementById("user").value,encodeURI(log));
			betIndex++;
		}
	}
	 
	
	function saveLog(user,log){
		 $.ajax({ url:  u + "/saveLog?user="+user +"&log="+log, 
	         async: false,
	         success: function(data) {
	        	 
	         	 }
	        });
		
	}
	function getCodeByPhase(phase){ //取得號碼
		 let code=""; 
		 $.ajax({ url:  u + "/getCode?phase="+phase, 
	         async: false,
	         success: function(data) {
	        	 code = data;
	         	 }
	        });
		 return code ;
	}
	
	
	function getPhase(count){ //取得期數
		 let period=""; 
		 $.ajax({ url:  u + "/getPhase", 
	         async: false,
	         success: function(data) {
	               period = data;
	           	   $( "div.toPhase" ).text(data);
	         	 }
	        });
		 return period*1 - count ;
	}
 	function saveParam(){
 		 
 		if($( ".type" ).val() && $( ".betlist" ).val() && $( ".stoplose" ).val() && $( ".stopwin" ).val()){
 			const url =  u + "/saveParam?" + "user="+document.getElementById("user").value+"&type="+$( ".type" ).val()+
 			"&betlist="+$( ".betlist" ).val()+"&stoplose="+$( ".stoplose" ).val()+"&stopwin="+$( ".stopwin" ).val() ;
 			$.get(url, function( data ) {
	    	 	 
		 	}); 
 		}
 		
 	}
 	
 	function checkWin(){
 		if((stoplose*-1 < todayWin*1) && (todayWin*1 < stopwin*1))
 			return true;
 		
 		return false;
 	}
    function timeout() {
    	
   		var d = new Date();
	    var n = d.getMinutes();
		if(checkMinute.indexOf(n) != -1 && checkWin()){ //bet time每5分鐘下注一次
			getWinFun();
		
			 const n = getPhase(1);
			 const b = getPhase(5);
			 const fourTh = getPhase(4);

			 
			 compareByType1(b,n,fourTh);
			 
		}
		
	    setTimeout(function () {
	    	    
	        timeout();
	    }, 60000);
	}
 	 
	function parse_query_string(query) {
		  var vars = query.split("&");
		  var query_string = {};
		  for (var i = 0; i < vars.length; i++) {
		    var pair = vars[i].split("=");
		    // If first entry with this name
		    if (typeof query_string[pair[0]] === "undefined") {
		      query_string[pair[0]] = decodeURIComponent(pair[1]);
		      // If second entry with this name
		    } else if (typeof query_string[pair[0]] === "string") {
		      var arr = [query_string[pair[0]], decodeURIComponent(pair[1])];
		      query_string[pair[0]] = arr;
		      // If third or later entry with this name
		    } else {
		      query_string[pair[0]].push(decodeURIComponent(pair[1]));
		    }
		  }
		  return query_string;
	}

</script>