
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">


<title>Login</title>

<!-- Bootstrap core CSS -->
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="dashboard.css" rel="stylesheet">
<link rel="stylesheet" href="jquery-ui-1.11.4/jquery-ui.css">
  
<style>
		table, th, td {
			border: 1px solid black;
			border-collapse: collapse;
			font-size: 8px;
			width:100%;
		}
		
	    .center_column{
	    	position: absolute;
	    	top: 230px;
	    	left: 400px;
	    }
	    
	    .left_column{
	    	position: absolute;
	    	top: 250px;
	    	left: 0%;
	    }
	    
	    .right_column{
	    	position: absolute;
	    	top: 230px;
	    	left: 850px;
	    }
		 
		 
</style>
</head>


<body>


<form name="form1">
	 <table>
		<tr>
			<td nowrap>
					今日輸贏 
			</td>
			<td>
					 <div  class="toDayWin">loading...</div>
			</td>
			<td>
					帳號  
			</td>
			<td colspan=3>
				 <input type="text" id="user" readonly />
			</td>
			
	      		    <td rowspan="5">下注方式</td>
	
					<td> <input type="checkbox" name="c1" id="c1" value="1" onclick="return chk(this);">金星-公式1 </td> 
					<td>下注參數</td> 
					<td> <input class="betlist" type ="text" size=35/></td> 
        </tr>
	 
		<tr>
		    <td>
					點數
			</td>
			<td>
					 <div  class="maxcredit">loading...</div>
			</td>
			<td>
					已用點數
			</td>
			<td>
					 <div  class="useBet">loading...</div>
			</td>
			<td>
					浮動點數
			</td>
			<td>
					 <div  class="cash">loading...</div>
			</td>
			        <td> <input type="checkbox" name="c1" id="c2" value="2" onclick="return chk(this);">金星-公式2</td> 
				    <td>下注參數</td> 
					<td> <input class="betlist2" type ="text" size=35/></td> 
		</tr>
		
		<tr  >
			<td>
					盤口目前期別 
			</td>
			<td colspan=5>
					 <div  class="toPhase">loading..</div>
			</td>
			
			<td nowrap> <input type="checkbox" name="c1" id="c3" value="3" onclick="return chk(this);">金星-公式3</td>
			<td nowrap>下注參數</td> 
					<td> <input class="betlist3" type ="text" size=35/></td> 
		</tr>
		<tr  >
			<td>
					盤口開獎期別
			</td>
			<td>
					 <div  class="toNowPhase">loading...</div>
			</td>
			<td >
					距截止下注時間
			</td>
			<td colspan=3>
					<div  class="nextBetTime">loading...</div>
			</td>
			
			
			 <td nowrap> <input type="checkbox" name="c1" id="c4" value="4" onclick="return chk(this);">金星-大小</td>
			 <td nowrap>下注參數</td> 
			 <td> <input class="betlist4" type ="text" size=35/></td> 
		</tr>
		
		<tr  >
			<td>
					開獎號碼
			</td>
			<td colspan=5>
					  <div  class="nowCode">loading...</div>
			</td>
			 <td nowrap> <input type="checkbox" name="c1" id="c5" value="5" onclick="return chk(this);">金星-單雙</td>
			<td nowrap>下注參數</td> 
					<td> <input class="betlist5" type ="text" size=35/></td> 
		</tr>
		
		
			<tr>
			<td>
					程式啟動 
			</td>
			<td   >
					       <select class="startstatus">
						  <option value="0">停用 </option>
						  <option value="1">啟用 </option> 
						</select> 
			</td>
			
			<td colspan=2 >
				<div id="connectURL">連結尚銀</div>	  
			</td>
			<td  >
				使用期限  
			</td>
			<td  >
				<div id="extendtime">loading.</div>	  
			</td>
			
			<td >止損金額 </td>
					<td  > <input class="stoplose" type ="text" size=15/> </td> 
			 <td >止盈金額 </td>
					<td  colspan=12> <input class="stopwin" type ="text" size=15/> </td> 
		</tr>
	 </table> 
	   
	  
	 
	     
      
	<input type="hidden" id="uid" />
	
	<input type="hidden" id="mid" />
	<input type="hidden" id="pwd" />
	
	
	<div class="left_column">
	<div  >歷史記錄</div>
	<div class="historyHtml"></div>
	</div>
	
	<div class="center_column">
	<div id="target">清空記錄</div>
	<div  >下注記錄</div>
	
	<div   class="logHtml">loading...</div>
	</div>	
	
	<div class="right_column">
	<div id="target2">清空記錄</div>
	<div >過關記錄</div>
	
	<div   class="logOverHtml">loading...</div>
	</div>			
				 
		 
 </form>
</body>
</html>

<script>
  function chk(input){

    for(var i=0;i<document.form1.c1.length;i++)
    {
      document.form1.c1[i].checked = false;
    }
    
    input.checked = true;
    saveParam();
    
    //clear
    betIndex = {
 			'1' : 0,
 			'2' : 0,
 			'3' : 0,
 			'4' : 0,
 			'5' : 0,
 			'6' : 0,
 			'7' : 0,
 			'8' : 0,
 			'9' : 0,
 			'10' : 0,

 	};
    betIndex2 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
	betIndex3 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
    betIndex4 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
    betIndex5 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
    return true;
  }
  
  function getType(){
	  let type = '';
	  if(document.getElementById('c1').checked) { type+='1@'; }
	  if(document.getElementById('c2').checked) { type+='2@'; }
	  if(document.getElementById('c3').checked) { type+='3@'; }
	  if(document.getElementById('c4').checked) { type+='4@'; }
	  if(document.getElementById('c5').checked) { type+='5@'; }
	  
	  return type.substring(0,type.length-1);

  }
  
  function setbetType(t){
	  if(t.indexOf('1')!=-1){document.getElementById("c1").checked = true;}
	  if(t.indexOf('2')!=-1){document.getElementById("c2").checked = true;}
	  if(t.indexOf('3')!=-1){document.getElementById("c3").checked = true;}
	  if(t.indexOf('4')!=-1){document.getElementById("c4").checked = true;}
	  if(t.indexOf('5')!=-1){document.getElementById("c5").checked = true;}
  }
  </script>
  
<script src="jquery.js"> </script>
<script src="utils.js"> </script>
<script src="pro.js"> </script>
<script src="jquery-ui-1.11.4/jquery-ui.js"> </script>
<script>
	 
 	const checkMinute = [4,9,14,19,24,29,34,39,44,49,54,59];
 	var u = getUrl();
    var stoplose = "";
    var stopwin = "";
    var todayWin = "";
    var cash = ""; 
    var useBet = ""; 
    var maxcredit = ""; 
    var ltype = "";
    var betarray = [];
    var betarray2 = [];
    var betarray3 = [];
    var betarray4 = [];
    var betarray5 = [];
    
    var betIndex  = {
 			'1' : 0,
 			'2' : 0,
 			'3' : 0,
 			'4' : 0,
 			'5' : 0,
 			'6' : 0,
 			'7' : 0,
 			'8' : 0,
 			'9' : 0,
 			'10' : 0,

 	};
    var betIndex2  = {
 			'1' : 0,
 			'2' : 0,
 			'3' : 0,
 			'4' : 0,
 			'5' : 0,
 			'6' : 0,
 			'7' : 0,
 			'8' : 0,
 			'9' : 0,
 			'10' : 0,

 	};
    var  betIndex3   = {
 			'1' : 0,
 			'2' : 0,
 			'3' : 0,
 			'4' : 0,
 			'5' : 0,
 			'6' : 0,
 			'7' : 0,
 			'8' : 0,
 			'9' : 0,
 			'10' : 0,

 	};
    var  betIndex4   = {
 			'1' : 0,
 			'2' : 0,
 			'3' : 0,
 			'4' : 0,
 			'5' : 0,
 			'6' : 0,
 			'7' : 0,
 			'8' : 0,
 			'9' : 0,
 			'10' : 0,

 	};
    var betIndex5  = {
 			'1' : 0,
 			'2' : 0,
 			'3' : 0,
 			'4' : 0,
 			'5' : 0,
 			'6' : 0,
 			'7' : 0,
 			'8' : 0,
 			'9' : 0,
 			'10' : 0,

 	};
 	const rangeExist = {
 			'01' : ['09','10','01','02','03'] ,
 			'02' : ['10','01','02','03','04'] ,
 			'03' : ['01','02','03','04','05'] ,
 			'04' : ['02','03','04','05','06'] ,
 			'05' : ['03','04','05','06','07'] ,
 			'06' : ['04','05','06','07','08'] ,
 			'07' : ['05','06','07','08','09'] ,
 			'08' : ['06','07','08','09','10'] ,
 			'09' : ['07','08','09','10','01'] ,
 			'10' : ['08','09','10','01','02'] ,

 	};
    $(document).ready(function(){
    
    		let url =  u + '/getHistory';
		  
      	 $.ajax({ url:  url, 
   	         async: true,
   	         success: function(data) {
   	        	  
   	        	    const json = JSON.parse(data);
   	        	  
   		    	 	$( "div.historyHtml" ).html(json.logHtml);
   		    	 	 
    
   	         	 } 
   	         	 
         });
      	 
		 $( "#tabs" ).tabs();
		 $( "#target" ).click(function() {
			 clearLog();
		 });
		 $( "#target2" ).click(function() {
			 clearOverLog();
		 });
		 
		 $( "#connectURL" ).click(function() {
			 connectURL();
		 });
		 
		 
		var query = window.location.search.substring(1);
		var parsed_qs = parse_query_string(query);
		var uid = (parsed_qs.uid) ;
		var pwd = (parsed_qs.pwd) ;
		var user= (parsed_qs.user);
		var mid = (parsed_qs.mid) ;

		document.getElementById("uid").value = uid;
		document.getElementById("user").value = user;
		document.getElementById("mid").value = mid;
		document.getElementById("pwd").value = pwd;

	 
		//var frameUrl = "http://203.160.143.110/www_new/index_new.php?username="+user+"&usertype=a&langx=zh-cn&mid=2520&uid="+uid+"";
	    // $('#query_frame').attr('src', frameUrl)

		getWinFun();
		getlogHtml();
		 
	    //return;
		
		 $( ".startstatus" ).change(function() {
			 saveParam();
		 });
		   
		 /*$( ".type" ).change(function() {
			 saveParam();
		 });*/
		 $( ".betlist" ).change(function() {
			 saveParam();
		 });
		 $( ".betlist2" ).change(function() {
			 saveParam();
		 });
		 $( ".betlist3" ).change(function() {
			 saveParam();
		 });
		 $( ".betlist4" ).change(function() {
			 saveParam();
		 });
		 $( ".betlist5" ).change(function() {
			 saveParam();
		 });
		 $( ".stoplose" ).change(function() {
			 saveParam();
		 });
		 $( ".stopwin" ).change(function() {
			 saveParam();
		 });
		  
		 getPhase();
		 timeout();
		 getHistoryTimeout();
	});
	
    function pad2(n) { return n < 10 ? '0' + n : n }
    function getYYYYMMDDSS(){
   	 var date = new Date();
	
	 return ( date.getFullYear().toString() + '/' + pad2(date.getMonth() + 1)+ '/'  + pad2( date.getDate())+ '/' + pad2( date.getHours() )+ ':'  + pad2( date.getMinutes() )+ ':'  + pad2( date.getSeconds() ) );

    	
    }
    
    
    
    
    function getWinFun(){
    	 var url =  u + '/getTodayWin?user='+document.getElementById("user").value+'&uid='+encodeURI(document.getElementById("uid").value)  ;
		 var flag = true;  
    	 $.ajax({ url:  url, 
	         async: false,
	         success: function(data) {
	        	 if(data == 'null'){
	        		  flag = false;
	                  if(data == 'null'){
	                      window.location.href='/auto/index.html?user='+document.getElementById("user").value+'&pwd='+document.getElementById("pwd").value ;
	                  }

	        		  return;
	        	 }
	        	 const json = JSON.parse(data);
	        	  
		    	 	$( "div.toDayWin" ).text(json.todayWin);
		    	 	$( "div.cash" ).text(json.cash);
		    	 	$( "div.useBet" ).text(json.useBet);
		    	 	$( "div.maxcredit" ).text(json.maxcredit);

		    	 	let betType = json.type;
		    	 	setbetType(betType);
		    	 	
		    	 	$( ".betlist" ).val(json.betlist) ;
		    	 	$( ".betlist2" ).val(json.betlist2) ;
		    	 	$( ".betlist3" ).val(json.betlist3) ;
		    	 	$( ".betlist4" ).val(json.betlist4) ;
		    	 	$( ".betlist5" ).val(json.betlist5) ;

		    	 	$( ".stoplose" ).val(json.stoplose) ;
		    	 	$( ".stopwin" ).val(json.stopwin);
		    	 	$( ".startstatus" ).val(json.startstatus);

		    	  
		    	 	stoplose = json.stoplose;
		    	 	stopwin = json.stopwin;
		    	 	todayWin = json.todayWin;
		    	 	cash = json.cash;
		    	 	betarray = json.betlist.split(',');
		    	 	betarray2 = json.betlist2.split(',');
		    	 	betarray3 = json.betlist3.split(',');
		    	 	betarray4 = json.betlist4.split(',');
		    	 	betarray5 = json.betlist5.split(',');

		    	 	ltype = json.ltype;
	         	 } 
	         	 
	        });
    	 return flag;
	     
    	
    }
    
    function getlogHtml(){
   	 var url =  u + '/getPredictLog?user='+document.getElementById("user").value+"bet";
		   
   	 $.ajax({ url:  url, 
	         async: true,
	         success: function(data) {
	        	  
	        	 const json = JSON.parse(data);
	        	  
		    	 	$( "div.logHtml" ).html(json.logHtml);
		    	 	 
 
	         	 } 
	         	 
      });
   	 
   	 
     url =  u + '/getPredictLog?user='+document.getElementById("user").value+"overLOGDIS";
	   
  	 $.ajax({ url:  url, 
	         async: true,
	         success: function(data) {
	        	  
	        	 const json = JSON.parse(data);
	        	  
		    	 	$( "div.logOverHtml" ).html(json.logHtml);
		    	 	 

	         	 } 
	         	 
     });
   	 
	     
   	
   }
    
	function compareByType1(phase_before,phase_now,phase_before4, gid, bIndex, bArray){
		   
		const code_b = getCodeByPhase(phase_before); 
		const code_n = getCodeByPhase(phase_now);
		const code_before4 = getCodeByPhase(phase_before4);
		
		const array_b = code_b.split(',');
		const array_n = code_n.split(',');
		const array_before4 = code_before4.split(',');
		if(array_b.length==0 || array_n.length==0 || array_before4.length==0  ){
			return;
		}
		for(var i=0;i<10;i++){
			const bet_b = array_b[i];
			const bet_n = array_n[i];
			const bet_before4 = array_before4[i];
 
		 	var d = getYYYYMMDDSS();
			var z = i+1;
		    if(bArray[0]==0 && rangeExist[bet_b].indexOf(bet_n) != -1){ //預測到、關卡歸零
		    	 
		    
		    	var suclog =  d + "第"+z+"名"+ " 此期" + phase_now  + "(開獎:"+code_n+")," +  " 預測期數 "+phase_before + "預測("+rangeExist[bet_b]+") ,有預測到，下一關，此注不下注" ;
	 
		    	saveLog(document.getElementById("user").value,encodeURI(suclog));

		    	bIndex[z] = 0;
			}

		    	//未預測到、投注
				//取前四期的號碼來預測投注
			 
		    	var log =  d + "第"+z+"名"+ " 此期" + phase_now  + "(開獎:"+code_n+")," + " 預測期數 "+phase_before + "預測("+rangeExist[bet_b]+") ,沒有預測到 ,下注" ;
		    	log+= "， 參考期數"+  phase_before4 + "("+code_before4+"), 下注號碼"+ rangeExist[bet_before4];
				
		    	log+= ",下注金額:"+bArray[bIndex[z]%bArray.length];
		    	var c = bArray[bIndex[z]%bArray.length] == 0 ? '0' : computeCase(bArray,bArray[bIndex[z]%bArray.length]);
		    	var suc = bArray[bIndex[z]%bArray.length] > 1 ? "成功" : "失敗" ;
		    	var betlog =  "預測第"+ (phase_now+1) +"期"+ "，第"+z+"名，號碼("+rangeExist[bet_before4]+")"+ "，第"+c+"關"+"下注金額("+bArray[bIndex[z]%bArray.length]+")"+"("+suc+")";
		    	
		    	var betList =  rangeExist[bet_before4].toString().split(',');
		    	
		    	
		    	var writeFlag = false;
		    	for(var b=0;b<betList.length;b++){
		    		var code = betList[b];
		    		var sn = i==9 ? 0 : (i+1);
		    		if(bArray[bIndex[z]%bArray.length]  > 0 ){
		    			reallyBet(gid,sn,code,bArray[bIndex[z]%bArray.length]);
		    			writeFlag = true;
		    			//處理過關的log
		    			let overLog = (phase_now+1) + "@" + sn + "@" + code ; 
		    			saveOverLog(document.getElementById("user").value,encodeURI(overLog));
		    		}
		    			
		    	}
		    	if(writeFlag)
		    		saveLog(document.getElementById("user").value+"bet",encodeURI(betlog)); //只寫下注成功的log
		    		
		    		
		    	saveLog(document.getElementById("user").value,encodeURI(log));
		    	bIndex[z]++;
		 
			
			
		}
		
	}
	function computeCase(f_barray,f_bIndex){
		var index = f_barray.indexOf(f_bIndex);
		var c = 0;
		for(var i=0;i<index;i++){
			if(f_barray[i]>0){
				c++;
			}
		}
		
		return c + 1 ;
	}
	function reallyBet(gid,sn,code,amount){
		$.ajax({ url:  u + "/bet?user="+document.getElementById("user").value +"&gid="+gid +"&uid="+encodeURI(document.getElementById("uid").value)+"&mid="+ document.getElementById("mid").value+
				"&sn="+sn+"&code="+code+"&amount="+amount+"&ltype="+ltype,  
         async: false,
         success: function(data) {
        	 
         	 }
        });
		
	}
	 
	
	function saveLog(user,log){
		 $.ajax({ url:  u + "/saveLog?user="+user +"&log="+log, 
	         async: false,
	         success: function(data) {
	        	 
	         	 }
	        });
		
	}
	function saveOverLog(user,log){
		 $.ajax({ url:  u + "/saveOverLog?user="+user +"&log="+log, 
	         async: false,
	         success: function(data) {
	        	 
	         	 }
	        });
		
	}
	
	function getCodeByPhase(phase){ //取得號碼
		 let code=""; 
		 $.ajax({ url:  u + "/getCode?phase="+phase, 
	         async: false,
	         success: function(data) {
	        	 code = data;
	         	 }
	        });
		 return code ;
	}
	
	
	function getPhase(){ //取得期數
		 let period=""; 
		 $.ajax({ url:  u + "/getPhase", 
	         async: false,
	         success: function(data) {
			        	 if(data == 'null'){
			        		 period = 0 ;
			        		 //解決跳號問題
			        		 betIndex = {
			      		 			'1' : 0,
			      		 			'2' : 0,
			      		 			'3' : 0,
			      		 			'4' : 0,
			      		 			'5' : 0,
			      		 			'6' : 0,
			      		 			'7' : 0,
			      		 			'8' : 0,
			      		 			'9' : 0,
			      		 			'10' : 0,

			      		 	};
			        	    betIndex2 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
			      			betIndex3 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
			      			betIndex4 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
			      			betIndex5 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
			        	 }else {
			        		   period = data;
			           	   $( "div.toPhase" ).text(data);
			           	   let nphase = data - 1;
			           	   $( "div.toNowPhase" ).text(nphase);
			           	   
			               let c = getCodeByPhase(nphase);
			               $( "div.nowCode" ).text(c);
			               
			        	 }
	              
	         	 }
	        });
		 return period*1  ;
	}
 	function saveParam(){
 		let type = getType();
 		let betParam = getBetListParam();
 		if($( ".stoplose" ).val() && $( ".stopwin" ).val() && $( ".startstatus" ).val() ){
 			const url =  u + "/saveParam?" + "user="+document.getElementById("user").value+"&type="+ type+
 			betParam
 			+"&stoplose="+$( ".stoplose" ).val()+"&stopwin="+$( ".stopwin" ).val()+"&startstatus="+$( ".startstatus" ).val()  ;
 			$.get(url, function( data ) {
	    	 	 	alert("設定完成!")
		 	}); 
 		}
 		
 	}
 	function getBetListParam(){
 		let p = "";
 		if($( ".betlist" ).val()){ p+= "&betlist="+$( ".betlist" ).val() ; } else {p+= "&betlist=0" ;}
 		if($( ".betlist2" ).val()){ p+= "&betlist2="+$( ".betlist2" ).val() ; }else {p+= "&betlist2=0" ;}
 		if($( ".betlist3" ).val()){ p+= "&betlist3="+$( ".betlist3" ).val() ; }else {p+= "&betlist3=0" ;}
 		if($( ".betlist4" ).val()){ p+= "&betlist4="+$( ".betlist4" ).val() ; }else {p+= "&betlist4=0" ;}
 		if($( ".betlist5" ).val()){ p+= "&betlist5="+$( ".betlist5" ).val() ; }else {p+= "&betlist5=0" ;}
 		return p;
 	}
 	
 	function checkWin(){
 		if((stoplose*-1 < todayWin*1) && (todayWin*1 < stopwin*1) && ( $( ".startstatus" ).val() == '1'))
 			return true;
 		
 		if(!(stoplose*-1 < todayWin*1) || !(todayWin*1 < stopwin*1)){
 			$( ".startstatus" ).val(0) ;
 		}
 		
 		
 		return false;
 	}
 	
 	function checkTime(h){
 		
 		var flag = false;
 		if(h*1 > 8 && h*1 < 24) {
 			flag = true;
 		}else {
 			betIndex = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
 			betIndex2 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
 			betIndex3 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
 			betIndex4 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
 			betIndex5 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };

 		}
 		return flag;
 	    
 	}
    function timeout() {
    	
   		
		
	    setTimeout(function () {
    	        var winFlag = getWinFun(); 
    	        var nextPhase = "";
			    if(winFlag){
			    	var d = new Date();
				    var n = d.getMinutes();
				    var h = d.getHours();
				    
			        if(checkMinute.indexOf(n) != -1 && checkWin() && checkTime(h)){ //bet time每5分鐘下注一次
			        	nextPhase = getPhase(); 
			        	let o = selectTypeToBet(nextPhase);  
					 
					}
			    	
			    }
			    if(nextPhase){
			    	checkOver(nextPhase);
			    }
			    getlogHtml();
		        
	        timeout();
	    }, 60000);
	}
    
	function getHistoryTimeout() {
    	
   		
		
	    setTimeout(function () {
    	        
		    	 	let url =  u + '/getHistory';
				   
		       	 $.ajax({ url:  url, 
		    	         async: true,
		    	         success: function(data) {
		    	        	  
		    	        	    const json = JSON.parse(data);
		    	        	  
		    		    	 	$( "div.historyHtml" ).html(json.logHtml);
		    		    	 	 
		     
		    	         	 } 
		    	         	 
		          });
		        
			    getHistoryTimeout();
	    }, 60000);
	}
    
    
    //檢查過關
    function checkOver(nextPhase){
    	let phase_now = nextPhase - 1 
    	let code_n = getCodeByPhase(phase_now);
    	let array  = code_n.split(',');
    	if(array.length==0){
    		clearIndex();
			return;
		} 
	   	 $.ajax({ url:  u + "/checkOver?user="+document.getElementById("user").value+"&phase="+phase_now+"&code="+code_n, 
	         async: false,
	         success: function(data) {
	        	 const json = JSON.parse(data);
	        	 if(json.a){betIndex[1] = 0;betIndex2[1] = 0;betIndex3[1] = 0;betIndex4[1] = 0;betIndex5[1] = 0; }
	        	 if(json.b){betIndex[2] = 0;betIndex2[2] = 0;betIndex3[2] = 0;betIndex4[2] = 0;betIndex5[2] = 0; }
	        	 if(json.c){betIndex[3] = 0;betIndex2[3] = 0;betIndex3[3] = 0;betIndex4[3] = 0;betIndex5[3] = 0; }
	        	 if(json.d){betIndex[4] = 0;betIndex2[4] = 0;betIndex3[4] = 0;betIndex4[4] = 0;betIndex5[4] = 0; }
	        	 if(json.e){betIndex[5] = 0;betIndex2[5] = 0;betIndex3[5] = 0;betIndex4[5] = 0;betIndex5[5] = 0; }
	        	 if(json.f){betIndex[6] = 0;betIndex2[6] = 0;betIndex3[6] = 0;betIndex4[6] = 0;betIndex5[6] = 0; }
	        	 if(json.g){betIndex[7] = 0;betIndex2[7] = 0;betIndex3[7] = 0;betIndex4[7] = 0;betIndex5[7] = 0; }
	        	 if(json.h){betIndex[8] = 0;betIndex2[8] = 0;betIndex3[8] = 0;betIndex4[8] = 0;betIndex5[8] = 0; }
	        	 if(json.i){betIndex[9] = 0;betIndex2[9] = 0;betIndex3[9] = 0;betIndex4[9] = 0;betIndex5[9] = 0; }
	        	 if(json.j){betIndex[10]= 0;betIndex2[10] = 0;betIndex3[10] = 0;betIndex4[10] = 0;betIndex5[10] = 0; }

         	 }
	        });
    	
    	
    }
    
    function clearIndex(){
    		betIndex = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
			betIndex2 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
			betIndex3 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
			betIndex4 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
			betIndex5 = { '1' : 0, '2' : 0, '3' : 0, '4' : 0, '5' : 0, '6' : 0, '7' : 0, '8' : 0, '9' : 0, 	'10' : 0, };
    }
    function selectTypeToBet(nextPhase){
    	  const n = nextPhase - 1 ;
    	  const gid = nextPhase - 554432 ;
    	  let obj = {} ; 
    	 
	    	  if(document.getElementById('c1').checked) { 
	    		  obj.b = nextPhase - 5 ;
	    		  obj.fourTh = nextPhase - 4 ;
	    		  const b = obj.b ;
			  const fourTh = obj.fourTh ;
			  if(isNumber(nextPhase) && isNumber(n)&& isNumber(b)&& isNumber(fourTh)&& isNumber(gid)){
				 	compareByType1(b,n,fourTh,gid,betIndex,betarray);
			  }
	    	  }
		  if(document.getElementById('c2').checked) {
			  obj.b = nextPhase - 6 ;
			  obj.fourTh = nextPhase - 5 ; 
			  const b = obj.b ;
			  const fourTh = obj.fourTh ;
			  if(isNumber(nextPhase) && isNumber(n)&& isNumber(b)&& isNumber(fourTh)&& isNumber(gid)){
				  compareByType1(b,n,fourTh,gid,betIndex2,betarray2);
			  }
		  }
		  
	  	 if(document.getElementById('c3').checked) {
		  obj.b = nextPhase - 7 ;
		  obj.fourTh = nextPhase - 6 ;
		  const b = obj.b ;
		  const fourTh = obj.fourTh ;
		  if(isNumber(nextPhase) && isNumber(n)&& isNumber(b)&& isNumber(fourTh)&& isNumber(gid)){
			  compareByType1(b,n,fourTh,gid,betIndex3,betarray3);		  
	 	  } 
      	 }
    	 if(document.getElementById('c4').checked) {
			 
			  obj.b = nextPhase - 6 ;
			  obj.fourTh = nextPhase - 5 ; 
			  const b = obj.b ;
			  const fourTh = obj.fourTh ;
			  if(isNumber(nextPhase) && isNumber(n)&& isNumber(b)&& isNumber(fourTh)&& isNumber(gid)){
				  compareByType2(b,n,fourTh,gid,betIndex2,betarray2);
			  }
		  }
		  
		  if(document.getElementById('c5').checked) {
			  obj.b = nextPhase - 6 ;
			  obj.fourTh = nextPhase - 5 ; 
			  const b = obj.b ;
			  const fourTh = obj.fourTh ;
			  if(isNumber(nextPhase) && isNumber(n)&& isNumber(b)&& isNumber(fourTh)&& isNumber(gid)){
				  compareByType3(b,n,fourTh,gid,betIndex2,betarray2);
			  }
		  }
	  	  return obj; 
    }
    function clearLog(){
    	
    	 $.ajax({ url:  u + "/clearLog?user="+document.getElementById("user").value+"bet", 
	         async: false,
	         success: function(data) {
	        	 $( "div.logHtml" ).html('');
	        	 alert("清空成功!");
	         	 }
	        });
 	 
 	}
    
    function clearOverLog(){
    	
   	 $.ajax({ url:  u + "/clearLog?user="+document.getElementById("user").value+"overLOGDIS", 
	         async: false,
	         success: function(data) {
	        	 $( "div.logOverHtml" ).html('');
	        	 alert("清空成功!");
	         	 }
	        });
		
	}
    
   
	
	

</script>